# Введение в Apache Airflow

## Нумерация версий

Начиная с версии 2.0.0 нумерация версий осуществяется следующим образом  
X.Y.Z  

- X - основной номер версии (**major release**), меняется при мажорном релизе и не имеет обратной совместимости с предыдущими версиями. То есть при переходе с версии X на X+1 нужно бедет переписывать логику взаимодействия
- Y - дополнительный номер версии (**feature release**), выпускаются раз в несколько месяцев содержан новые функции внутри основной версии
- Z - номер исправления (**patch release**), выпускаются по мере необходимости. Эти выпуски на 100% совместимы с предыдущими версиями и **всегда** необходимы для установки

## Основные компоненты

- **Scheduler (Планировщик)** - обрабатывает запуск дагов и задачи и отправкой задач на исполнитель
- **Worker (Исполнитель)** - исполняет таски переданные из планировщика. Причем задачи могут выполняться на той же машине что и планировщик, так и отдельно
- **Папка файлов с DAGs** - папка содержащая код ДАГов читаемая как планировщиком и исполнителем
- **Webserver (Веб-сервер)** - пользовательский веб интерфейс.
- **База данных с метаданными** - реляционная база данных (чаще всего PostgeSQL) используются планировщиком, исполнителем и веб сервером для хранения состояния  
Общая архитектурная схема:
![alt text](./pictures/arch_schema.png)

## Базовые абстракции

- **DAG** - класс дага с набор тасок и зависимостями между ними, а также прочих настроек
- **Task** - класс тех или иных операторов или сенсоров.
- **DAG run** - конкретный *"запуск"* ДАГа. Имеет атрибуты: когда запустился, статус выполнения и т.д.
- **Task Instance** - конкретный *"запуск"* таски, также имеют собственные атрибуты
![alt text](./pictures/base_abstraction.png)

## Поток управления

Элементы потока управления:
![alt text](./pictures/dag_abstraction.png)

- Все эллементы потока управления имеют зависимости друг от друга.
- Выстраивание зависимостей между элементами потока управления создается с помощью операторов `>>` и `<<` или при помощи методов `set_upstream` и `set _downstream`

```python
task_1 >> [task_2, task_3]
task_4 << task_3

task_1.set_downstream([task_2, task_3])
task_4.set_upstream(task_3)
```

46:49
